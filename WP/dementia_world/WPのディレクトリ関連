ãªã‚‹ã»ã©ã€ã‚µãƒ¼ãƒãƒ¼ã§ã¯ /dementia_world/ ã« WordPress ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‚“ã§ã™ã­ã€‚
ãã‚Œãªã‚‰ã€ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã® Docker ã§ã‚‚åŒã˜æ§‹æˆã«ã™ã‚Œã°å‹•ä½œãŒä¸€è‡´ã™ã‚‹ ã®ã§ã€ãã®ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã—ã‚‡ã†ï¼

âœ… ä¿®æ­£å¾Œã® docker-compose.ymlï¼ˆ/dementia_world/ ã« WordPress ã‚’é…ç½®ï¼‰
yaml
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
version: '3'

services:
  db:
    platform: linux/amd64 # M1/M2 Macå¯¾å¿œ
    image: mysql:5.7
    volumes:
      - db_data:/var/lib/mysql
    restart: on-failure:5
    ports:
      - "${LOCAL_DB_PORT:-3306}:3306"
    container_name: "${PRODUCTION_NAME:-wp}_db"
    environment:
      MYSQL_ROOT_PASSWORD: wordpress
      MYSQL_DATABASE: wordpress
      MYSQL_USER: wordpress
      MYSQL_PASSWORD: wordpress

  wordpress:
    depends_on:
      - db
    image: wordpress:latest
    container_name: "${PRODUCTION_NAME:-wp}_wordpress"
    ports:
      - "${LOCAL_SERVER_PORT:-8080}:80"
    restart: on-failure:5
    volumes:
      - ./dementia_world:/var/www/html/dementia_world  # `/dementia_world/` ã«é…ç½®
    environment:
      WORDPRESS_DB_HOST: db:3306
      WORDPRESS_DB_NAME: wordpress
      WORDPRESS_DB_USER: wordpress
      WORDPRESS_DB_PASSWORD: wordpress

volumes:
  db_data:
ğŸ” å¤‰æ›´ç‚¹
ä¿®æ­£å‰	ä¿®æ­£å¾Œ
/var/www/html ã« WordPress ã‚’é…ç½®	/var/www/html/dementia_world ã«é…ç½®
http://localhost:8080/ ã§ã‚¢ã‚¯ã‚»ã‚¹	http://localhost:8080/dementia_world/ ã§ã‚¢ã‚¯ã‚»ã‚¹
ã‚µãƒ¼ãƒãƒ¼ç’°å¢ƒã¨ç•°ãªã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ	ã‚µãƒ¼ãƒãƒ¼ã¨åŒã˜æ§‹æˆ ãªã®ã§æœ¬ç•ªã¨ä¸€è‡´
ğŸš€ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †
â‘  æ—¢å­˜ã® WordPress ã‚’å‰Šé™¤
sh
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
docker-compose down -v  # ã™ã¹ã¦å‰Šé™¤ï¼ˆDBå«ã‚€ï¼‰
rm -rf dementia_world db_data  # å¤ã„ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤
â‘¡ dementia_world ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆ
sh
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
mkdir dementia_world
â‘¢ WordPress ã‚’å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sh
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
docker-compose up -d
â‘£ WordPress ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
http://localhost:8080/dementia_world/ ã«ã‚¢ã‚¯ã‚»ã‚¹

è¨€èªã‚’é¸æŠ

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æƒ…å ±ã‚’å…¥åŠ›

DBå: wordpress

ãƒ¦ãƒ¼ã‚¶ãƒ¼å: wordpress

ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: wordpress

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ›ã‚¹ãƒˆ: db

WordPressã®ã‚µã‚¤ãƒˆæƒ…å ±ã‚’å…¥åŠ›

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Œäº† ğŸ‰

ğŸ¯ ã“ã®æ–¹æ³•ã®ãƒ¡ãƒªãƒƒãƒˆ
âœ… ã‚µãƒ¼ãƒãƒ¼ã¨åŒã˜ /dementia_world/ é…ä¸‹ã« WordPress ã‚’é…ç½®
âœ… Apache ã®è¨­å®šå¤‰æ›´ä¸è¦ï¼
âœ… ç’°å¢ƒå¤‰æ•°ãŒ .env ã«æœªå®šç¾©ã§ã‚‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§å‹•ä½œã™ã‚‹ï¼
âœ… æœ¬ç•ªã¨åŒã˜ URL (http://localhost:8080/dementia_world/) ã§é–‹ç™ºã§ãã‚‹

ğŸ”¥ ã¾ã¨ã‚
ã‚µãƒ¼ãƒãƒ¼ã® /dementia_world/ ã«åˆã‚ã›ã‚‹ã«ã¯ã€
Docker ã® volumes ã‚’ /var/www/html/dementia_world ã«ãƒã‚¦ãƒ³ãƒˆã™ã‚‹ã®ãŒæ­£è§£ ã§ã™ï¼ ğŸš€



â‘  WordPress ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æ¨©é™ã‚’ä¿®æ­£
ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€dementia_world ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æ‰€æœ‰è€…ã‚’ www-data ã«å¤‰æ›´ã—ã¾ã™ã€‚

sh
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
chown -R www-data:www-data /var/www/html/dementia_world
chmod -R 755 /var/www/html/dementia_world
ãã®å¾Œã€è¨­å®šãŒåæ˜ ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªï¼š

sh
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
ls -l /var/www/html
ls -l /var/www/html/dementia_world
www-data www-data ã«ãªã£ã¦ã„ã‚Œã°OKï¼
ã‚‚ã— root ã«ãªã£ã¦ã„ãŸã‚‰ã€ã‚‚ã†ä¸€åº¦ chown ã‚’è©¦ã—ã¦ãã ã•ã„ã€‚

â‘¡ Apache ã®è¨­å®šã‚’ç¢ºèª
ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ apache2ctl -S ã‚’å®Ÿè¡Œã—ã€Apache ã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

sh
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
apache2ctl -S
ã‚‚ã— /var/www/html ä»¥å¤–ã® DocumentRoot ãŒè¨­å®šã•ã‚Œã¦ã„ãŸå ´åˆã€000-default.conf ã‚’ä¿®æ­£ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ã¾ãšã€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãã¾ã™ï¼š

sh
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
nano /etc/apache2/sites-available/000-default.conf
ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿®æ­£ï¼ˆ<Directory> ã®è¨­å®šã‚’è¿½åŠ ï¼‰

apache
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
<VirtualHost *:80>
    DocumentRoot /var/www/html

    <Directory /var/www/html/dementia_world>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>
ä¿å­˜ (Ctrl + X, Y, Enter) ã—ãŸã‚‰ã€Apache ã‚’å†èµ·å‹•ã—ã¾ã™ã€‚

sh
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
service apache2 restart
â‘¢ .htaccess ã‚’ç¢ºèª
WordPress ã® .htaccess ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£ã—ãå­˜åœ¨ã™ã‚‹ã‹ç¢ºèªï¼š

sh
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
ls -l /var/www/html/dementia_world/.htaccess
ã‚‚ã— .htaccess ãŒãªã„å ´åˆã€æ–°ã—ãä½œæˆã—ã¾ã™ã€‚

sh
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
nano /var/www/html/dementia_world/.htaccess
ä»¥ä¸‹ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦è²¼ã‚Šä»˜ã‘ï¼š

apache
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
# BEGIN WordPress
RewriteEngine On
RewriteBase /dementia_world/
RewriteRule ^index\.php$ - [L]

# add a trailing slash to /wp-admin
RewriteRule ^wp-admin$ wp-admin/ [R=301,L]

RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /dementia_world/index.php [L]
# END WordPress
ä¿å­˜ (Ctrl + X, Y, Enter) ã—ãŸã‚‰ã€ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚’ä¿®æ­£ï¼š

sh
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
chown www-data:www-data /var/www/html/dementia_world/.htaccess
chmod 644 /var/www/html/dementia_world/.htaccess
â‘£ mod_rewrite ã‚’æœ‰åŠ¹åŒ–
.htaccess ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãŒæ©Ÿèƒ½ã—ãªã„å ´åˆã€mod_rewrite ã‚’æœ‰åŠ¹ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

sh
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
a2enmod rewrite
service apache2 restart
â‘¤ Apache ã®ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ç¢ºèª
ã‚‚ã— 403 Forbidden ãŒè§£æ±ºã—ãªã„å ´åˆã€ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

sh
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
tail -n 20 /var/log/apache2/error.log
ã‚¨ãƒ©ãƒ¼å†…å®¹ã‚’è¦‹ã‚Œã°ã€ã©ã“ã«å•é¡ŒãŒã‚ã‚‹ã‹ç‰¹å®šã§ãã¾ã™ã€‚

ğŸš€ æœ€çµ‚ç¢ºèª
ã“ã‚Œã‚‰ã®è¨­å®šã‚’é©ç”¨ã—ãŸã‚‰ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:8080/dementia_world/ ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚
ã‚‚ã— 403 Forbidden ãŒè§£æ±ºã—ãªã„å ´åˆã€ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’è²¼ã£ã¦ã‚‚ã‚‰ãˆã‚Œã°ã€å…·ä½“çš„ãªè§£æ±ºç­–ã‚’è€ƒãˆã¾ã™ï¼